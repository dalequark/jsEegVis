var coreAudio = require("./node-core-audio");
 
var engine = coreAudio.createNewAudioEngine();
 
var numDevices = engine.getNumDevices();
 
var inputDeviceId;
var outputDeviceId;

console.log( "DEVICES" );
console.log( "DEVICES" );
console.log( "DEVICES" );
for (var i = 0; i < numDevices; i++) {
    var name = engine.getDeviceName(i);
    console.log( name );
    if (!inputDeviceId && /Line in/.test(name)) {
        inputDeviceId = i;
    }
    if (!outputDeviceId && /Haut-parleurs/.test(name)) {
        outputDeviceId = i;
    }
}

console.log( "DEVICES" );
console.log( "DEVICES" );
console.log( "DEVICES" );
 
var options = {
    inputChannels: 2,
    outputChannels: 2
};
 
engine.setOptions(options);
 
engine.addAudioCallback(function (inputBuffer) {
    for( var iSample in inputBuffer[0] )
        inputBuffer[0][iSample] = iSample/inputBuffer[0].length;

    return inputBuffer;
});